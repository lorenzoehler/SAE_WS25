---
title: "Variable selection"
author: "Lorenz Alban Oehler"
date: "The Date"
output:
  html_document:
    theme: flatly      
    toc: true          
    toc_float: true    
    toc_depth: 4       
    highlight: tango   
    df_print: paged    
    css: styles.css 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# introduction

In this document I want to 
- take a look at the census data set
- figure out a way of opening and manipulating the whole dataset
- figure out a systematic way of renaming the variables 

# Preprocessing

## loading the data

```{r}

library(data.table)
library(tidyverse)

Vivienda_CPV_2024 <- fread("../../data_raw/large_files/Vivienda_CPV-2024.csv")
head1000_houshold <- fread("../../data_raw/large_files/Vivienda_CPV-2024.csv", nrows = 10000)
head1000_houshold %>% lapply(X = .,FUN = summary)

```

# mapping 

In this section I want to prepare how we will map the values of the municipalities to the their shape file

```{r}
### load remapping csv exported via Redatam X
library(openxlsx)
mapping <- openxlsx::read.xlsx("../../data_raw/mapping/mapping.xlsx")
mp_municip <- mapping
mp_municip <- mp_municip[,c("Municipio/TIOC","Nombre.de.municipio/TIOC")]
colnames(mp_municip) <- c("code", "name")

### RDS for better handlability
saveRDS(mp_municip,file = "../../data_raw/mapping/mp_municip.RDS") 

```


## check how mapping matches to shape file

```{r}
### load shape file
library(sf)
map <- read_sf("../../data_raw/stanford-xg218hn4313-shapefile/xg218hn4313.shp")

map$name_3 %in% mp_municip$name %>% table()
```

some of them dont match, becaus this will probably be a frequent occurrence whenever one has to work with matching data, I will create a tempalte to vsualize the best matches (maybe using fuzzy matching etc.)


